1. Релиз (Release, боевой bundle id com.vit.5007ch4at4r)

Источник цен: реальный App Store / StoreKit 2.

Apphud: боевой, ходит в прод-среду, проверяет реальные подписки.

Paywall:

При старте приложения мы прелоадим продукты и кладём их в кэш.

При открытии Paywall сначала смотрим в кэш, если успели — сразу показываем реальные цены.

Если кэш ещё пустой, на 1–3 секунды показываются placeholder’ы (серые “скелетоны”), затем цены подгружаются.

Покупки и восстановление:

Используются реальные StoreKit / Apphud флоу.

Статус премиума хранится и проверяется через Apphud (hasActiveSubscription и т.п.).

После переустановки/смены устройства подписка подтягивается через Restore Purchases — как в боевом продукте.



2. Debug + боевой bundle id (com.vit.5007ch4at4r)

Предполагается, что тут тестировщики используют Sandbox-аккаунты Apple.

Источник цен: всё то же — StoreKit 2, но в режиме Sandbox.

Apphud: также используется реальный Apphud, но с sandbox-покупками.

Paywall:

Логика та же: сначала пробуем взять цены из кэша, если его ещё нет — грузим из StoreKit.

Временные placeholder’ы возможны, пока StoreKit не отдаст продукты.

Покупки и восстановление:

Идут через Sandbox StoreKit + Apphud.

Статус премиума запоминается Apphud’ом; в рамках Sandbox-подписок живёт столько, сколько настроено Apple (ускоренные интервалы).



3. Debug + НЕ боевой bundle id и НЕ боевая Team (локальная разработка)

В этом режиме мы исходим из того, что реальный App Store / Apphud могут быть недоступны (другой bundle id, другая команда).

Источник цен:

Сначала пробуем StoreKit 2.

Если продукты не доступны (частый вариант) — включается режим Debug-мока:

Показываются рисованные цены ($4.99 / week, $39.99 / year и т.п.).

На Paywall есть пометка, что это Debug prices, а не реальные данные App Store.

Apphud:

Для подписок в этом режиме используется stub-сервис:
покупка просто включает премиум на время текущей сессии.

Покупки и восстановление:

Покупка в этом режиме разблокирует все премиум-фичи только пока приложение запущено.

После перезапуска приложения премиум сбрасывается — это только локальная песочница разработчика для быстрого теста UI.

Restore в этом режиме по сути ничего реального не восстанавливает, т.к. мы сознательно не ходим ни в App Store, ни в Apphud боевым способом.